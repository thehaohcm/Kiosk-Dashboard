<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    body {
      background-color: #0f172a;
      color: #fff;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
    }
    .center-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center; /* <‚Äî canh gi·ªØa theo chi·ªÅu d·ªçc */
      min-height: 100vh;       /* chi·∫øm to√†n b·ªô chi·ªÅu cao m√†n h√¨nh */
      text-align: center;
      gap: 1rem;
      padding-top: 80px;       /* ch·ª´a ch·ªó cho topbar ƒë·ªìng h·ªì */
      box-sizing: border-box;
    }
    iframe {
      border: none;
      width: 90%;
      height: 480px;
      border-radius: 12px;
      box-shadow: 0 0 12px rgba(0,0,0,0.4);
    }
    .stock-table {
      margin-top: 1rem;
      border-collapse: collapse;
      width: 70%;
      max-width: 700px;
      background: #1e293b;
      border-radius: 10px;
      overflow: hidden;
    }
    .stock-table th, .stock-table td {
      padding: 8px 12px;
      border-bottom: 1px solid #2d3748;
    }
    .stock-table th {
      background-color: #334155;
      font-weight: bold;
    }
    .update-time {
      font-size: 0.9rem;
      color: #94a3b8;
      margin-top: 1rem;
    }
  </style>
</head>
<body class="slide-page">
  <header class="topbar">
    <div class="brand">üìà Th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam</div>
    <div class="datetime" id="clock">--:--:--</div>
  </header>

  <div class="center-container">
    <h2>Th·ªã tr∆∞·ªùng ch·ª©ng kho√°n Vi·ªát Nam</h2>

    <iframe src="https://stockchart.vietstock.vn" title="Stock Chart"></iframe>

    <h3>üî• C·ªï phi·∫øu ti·ªÅm nƒÉng</h3>
    <table class="stock-table">
      <tr>
        <th>M√£</th>
        <th>Gi√° cao nh·∫•t</th>
        <th>Gi√° th·∫•p nh·∫•t</th>
      </tr>
      {% for s in symbols %}
      <tr>
        <td>{{ s.symbol }}</td>
        <td>{{ s.highest_price }}</td>
        <td>{{ s.lowest_price }}</td>
      </tr>
      {% endfor %}
    </table>

    <div class="update-time">
      C·∫≠p nh·∫≠t l√∫c: {{ updated }}
    </div>
  </div>

  <script>
    // ƒê·ªìng h·ªì realtime g√≥c tr√™n
    function updateClock() {
      const now = new Date();
      const opts = { timeZone: 'Asia/Ho_Chi_Minh', hour12: false,
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit' };
      document.getElementById('clock').textContent =
        new Intl.DateTimeFormat('vi-VN', opts).format(now);
    }
    updateClock(); setInterval(updateClock, 1000);

    // Auto chuy·ªÉn page sau 2 ph√∫t
    const pages = ["/weather", "/gold", "/crypto", "/stock", "/news", "/finance"];
    let idx = pages.indexOf(window.location.pathname);
    if (idx === -1) idx = 0;
    setInterval(() => {
      idx = (idx + 1) % pages.length;
      window.location.href = pages[idx];
    }, 120000);

    /* ======= Preload images (OpenWeather icons + local icons) ======= */
    (function preloadImages() {
    const imgs = [
        // OpenWeather sample icons you might use (replace with icons your template actually uses)
        "http://openweathermap.org/img/wn/01d@2x.png",
        "http://openweathermap.org/img/wn/02d@2x.png",
        "http://openweathermap.org/img/wn/03d@2x.png",
        "http://openweathermap.org/img/wn/04d@2x.png",
        "http://openweathermap.org/img/wn/09d@2x.png",
        "http://openweathermap.org/img/wn/10d@2x.png",
        // local icons (example)
        "/static/img/weather/clear.png",
        "/static/img/weather/cloud.png",
        "/static/img/weather/rain.png"
    ];
    imgs.forEach(url => {
        const i = new Image();
        i.src = url;
    });
    })();

    /* ======= Preload TradingView script and warm it up offscreen ======= */
    (function warmupTradingView() {
        // n·∫øu already loaded th√¨ th√¥i
        if (window.TradingView) return;

        // 1) t·∫£i script v√†o b·ªô nh·ªõ (no blocking)
        const s = document.createElement('script');
        s.src = "https://s3.tradingview.com/tv.js";
        s.async = true;
        s.onload = () => {
            try {
            // 2) t·∫°o offscreen container ƒë·ªÉ init 1 widget "nh·∫π" (ƒë·∫∑t symbol r·ªóng)
            const off = document.createElement('div');
            off.style.position = 'fixed';
            off.style.left = '-9999px';
            off.style.width = '1px';
            off.style.height = '1px';
            off.id = 'tv-warmup';
            document.body.appendChild(off);

            // create a minimal widget to warm caches (no toolbar)
            new TradingView.widget({
                "container_id": "tv-warmup",
                "width": 1,
                "height": 1,
                "symbol": "BINANCE:BTCUSDT",
                "interval": "60",
                "theme": "dark",
                "locale": "en",
                "hide_side_toolbar": true,
                "allow_symbol_change": false,
                "enable_publishing": false
            });

            // remove warmup after short delay
            setTimeout(() => {
                const el = document.getElementById('tv-warmup');
                if (el) el.remove();
            }, 2500);
            } catch (e) {
            // silent
            console.debug("TV warmup failed", e);
            }
        };
        s.onerror = () => console.warn("Cannot preload TradingView script");
        document.head.appendChild(s);

        // Also prefetch the TradingView css/resources by creating a link rel=prefetch
        const p = document.createElement('link');
        p.rel = 'prefetch';
        p.href = 'https://s3.tradingview.com/tv.js';
        document.head.appendChild(p);
    })();
  </script>
</body>
</html>
