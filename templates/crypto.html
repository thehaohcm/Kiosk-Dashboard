<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Th·ªã tr∆∞·ªùng Crypto</title>
  <link rel="stylesheet" href="/static/style.css">
  <style>
    body {
      background-color: #0f172a;
      color: #fff;
      margin: 0;
      padding: 0;
      font-family: 'Inter', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex: 1;
      width: 100%;
      text-align: center;
      padding: 1rem;
      box-sizing: border-box;
    }

    h1 {
      font-size: 2rem;
      margin-bottom: 0.3rem;
    }

    #coin-label {
      font-size: 1.1rem;
      color: #a5b4fc;
      margin-bottom: 1rem;
    }

    .tradingview-widget-container {
      width: 90vw;
      height: 80vh;
      max-width: 900px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 15px rgba(0,0,0,0.4);
    }

    @media (orientation: landscape) {
      .tradingview-widget-container {
        width: 80vw;
        height: 75vh;
      }
    }

    header.topbar {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.6rem 1rem;
      background-color: #1e293b;
      font-weight: bold;
      color: #facc15;
      font-size: 1.1rem;
      box-sizing: border-box;
    }
  </style>
</head>

<body class="slide-page">
  <header class="topbar">
    <div class="brand">üíπ Th·ªã tr∆∞·ªùng Crypto</div>
    <div class="datetime" id="clock">--:--:--</div>
  </header>

  <div class="container">
    <h1>Th·ªã tr∆∞·ªùng Crypto</h1>
    <p id="coin-label">ƒêang t·∫£i...</p>
    <div class="tradingview-widget-container">
      <div id="tradingview_crypto"></div>
    </div>
  </div>

  <script src="https://s3.tradingview.com/tv.js"></script>
  <script>
    const coins = ["BTCUSDT", "ETHUSDT", "XRPUSDT", "BNBUSDT"];
    let index = 0;

    function loadChart(coin) {
      document.getElementById("coin-label").textContent = "Bi·ªÉu ƒë·ªì: " + coin;
      document.getElementById("tradingview_crypto").innerHTML = "";
      new TradingView.widget({
        "width": "100%",
        "height": "100%",
        "symbol": "BINANCE:" + coin,
        "interval": "30",
        "timezone": "Asia/Ho_Chi_Minh",
        "theme": "dark",
        "style": "1",
        "locale": "vi",
        "container_id": "tradingview_crypto"
      });
    }

    loadChart(coins[index]);
    setInterval(() => {
      index = (index + 1) % coins.length;
      loadChart(coins[index]);
    }, 30000);

    // Auto chuy·ªÉn trang
    const pages = ["/weather", "/gold", "/crypto", "/stock", "/news", "/finance"];
    let idx = pages.indexOf(window.location.pathname);
    if (idx === -1) idx = 0;
    setInterval(() => {
      idx = (idx + 1) % pages.length;
      window.location.href = pages[idx];
    }, 120000);

    // Hi·ªáu ·ª©ng slide
    document.body.classList.add("slide-page");
    document.body.style.transition = "transform 0.7s ease-in-out, opacity 0.7s ease-in-out";
    document.body.style.transform = "translateX(0)";
    document.body.style.opacity = "1";
    window.addEventListener("beforeunload", () => {
      document.body.style.transform = "translateX(-50px)";
      document.body.style.opacity = "0";
    });

    // ƒê·ªìng h·ªì realtime
    function updateClock() {
      const now = new Date();
      const opts = { timeZone: 'Asia/Ho_Chi_Minh', hour12: false,
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit' };
      const clock = document.getElementById('clock');
      if (clock) clock.textContent = new Intl.DateTimeFormat('vi-VN', opts).format(now);
    }
    updateClock();
    setInterval(updateClock, 1000);

    /* ======= Preload images (OpenWeather icons + local icons) ======= */
    (function preloadImages() {
      const imgs = [
        "http://openweathermap.org/img/wn/01d@2x.png",
        "http://openweathermap.org/img/wn/02d@2x.png",
        "http://openweathermap.org/img/wn/03d@2x.png",
        "http://openweathermap.org/img/wn/04d@2x.png",
        "http://openweathermap.org/img/wn/09d@2x.png",
        "http://openweathermap.org/img/wn/10d@2x.png",
        "/static/img/weather/clear.png",
        "/static/img/weather/cloud.png",
        "/static/img/weather/rain.png"
      ];
      imgs.forEach(url => {
        const i = new Image();
        i.src = url;
      });
    })();

    /* ======= Preload TradingView script and warm it up offscreen ======= */
    (function warmupTradingView() {
      if (window.TradingView) return;
      const s = document.createElement('script');
      s.src = "https://s3.tradingview.com/tv.js";
      s.async = true;
      s.onload = () => {
        try {
          const off = document.createElement('div');
          off.style.position = 'fixed';
          off.style.left = '-9999px';
          off.style.width = '1px';
          off.style.height = '1px';
          off.id = 'tv-warmup';
          document.body.appendChild(off);

          new TradingView.widget({
            "container_id": "tv-warmup",
            "width": 1,
            "height": 1,
            "symbol": "BINANCE:BTCUSDT",
            "interval": "60",
            "theme": "dark",
            "locale": "en",
            "hide_side_toolbar": true,
            "allow_symbol_change": false,
            "enable_publishing": false
          });

          setTimeout(() => {
            const el = document.getElementById('tv-warmup');
            if (el) el.remove();
          }, 2500);
        } catch (e) {
          console.debug("TV warmup failed", e);
        }
      };
      document.head.appendChild(s);
    })();
  </script>
</body>
</html>
