<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8">
  <title>Gi√° v√†ng</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body class="slide-page">
  <header class="topbar">
    <div class="brand">ü™ô Gi√° v√†ng h√¥m nay</div>
    <div class="datetime" id="clock">--:--:--</div>
  </header>

  <div class="container">
    <h1>Gi√° v√†ng h√¥m nay</h1>
    <p>{{ price_vnd }} VNƒê/ch·ªâ</p>
    <p>{{ price_usd }} USD/oz</p>

    <div class="tradingview-widget-container" style="height:500px;width:90%;">
      <div id="tradingview_gold"></div>
      <script src="https://s3.tradingview.com/tv.js"></script>
      <script>
        new TradingView.widget({
          "width": "100%",
          "height": 500,
          "symbol": "OANDA:XAUUSD",
          "interval": "60",
          "timezone": "Asia/Ho_Chi_Minh",
          "theme": "dark",
          "style": "1",
          "locale": "vi",
          "container_id": "tradingview_gold"
        });
      </script>
    </div>
  </div>

  <script>
    const pages = ["/weather", "/gold", "/crypto", "/stock", "/news", "/finance"];
    let idx = pages.indexOf(window.location.pathname);
    if (idx === -1) idx = 0;
    setInterval(() => {
      idx = (idx + 1) % pages.length;
      window.location.href = pages[idx];
    }, 120000);

    document.body.classList.add("slide-page");
    document.body.style.transition = "transform 0.7s ease-in-out, opacity 0.7s ease-in-out";
    document.body.style.transform = "translateX(0)";
    document.body.style.opacity = "1";
    window.addEventListener("beforeunload", () => {
      document.body.style.transform = "translateX(-50px)";
      document.body.style.opacity = "0";
    });

    function updateClock() {
      const now = new Date();
      const opts = { timeZone: 'Asia/Ho_Chi_Minh', hour12: false,
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit' };
      const clock = document.getElementById('clock');
      if (clock) clock.textContent = new Intl.DateTimeFormat('vi-VN', opts).format(now);
    }
    updateClock();
    setInterval(updateClock, 1000);

    /* ======= Preload images (OpenWeather icons + local icons) ======= */
    (function preloadImages() {
    const imgs = [
        // OpenWeather sample icons you might use (replace with icons your template actually uses)
        "http://openweathermap.org/img/wn/01d@2x.png",
        "http://openweathermap.org/img/wn/02d@2x.png",
        "http://openweathermap.org/img/wn/03d@2x.png",
        "http://openweathermap.org/img/wn/04d@2x.png",
        "http://openweathermap.org/img/wn/09d@2x.png",
        "http://openweathermap.org/img/wn/10d@2x.png",
        // local icons (example)
        "/static/img/weather/clear.png",
        "/static/img/weather/cloud.png",
        "/static/img/weather/rain.png"
    ];
    imgs.forEach(url => {
        const i = new Image();
        i.src = url;
    });
    })();

    /* ======= Preload TradingView script and warm it up offscreen ======= */
    (function warmupTradingView() {
        // n·∫øu already loaded th√¨ th√¥i
        if (window.TradingView) return;

        // 1) t·∫£i script v√†o b·ªô nh·ªõ (no blocking)
        const s = document.createElement('script');
        s.src = "https://s3.tradingview.com/tv.js";
        s.async = true;
        s.onload = () => {
            try {
            // 2) t·∫°o offscreen container ƒë·ªÉ init 1 widget "nh·∫π" (ƒë·∫∑t symbol r·ªóng)
            const off = document.createElement('div');
            off.style.position = 'fixed';
            off.style.left = '-9999px';
            off.style.width = '1px';
            off.style.height = '1px';
            off.id = 'tv-warmup';
            document.body.appendChild(off);

            // create a minimal widget to warm caches (no toolbar)
            new TradingView.widget({
                "container_id": "tv-warmup",
                "width": 1,
                "height": 1,
                "symbol": "BINANCE:BTCUSDT",
                "interval": "60",
                "theme": "dark",
                "locale": "en",
                "hide_side_toolbar": true,
                "allow_symbol_change": false,
                "enable_publishing": false
            });

            // remove warmup after short delay
            setTimeout(() => {
                const el = document.getElementById('tv-warmup');
                if (el) el.remove();
            }, 2500);
            } catch (e) {
            // silent
            console.debug("TV warmup failed", e);
            }
        };
        s.onerror = () => console.warn("Cannot preload TradingView script");
        document.head.appendChild(s);

        // Also prefetch the TradingView css/resources by creating a link rel=prefetch
        const p = document.createElement('link');
        p.rel = 'prefetch';
        p.href = 'https://s3.tradingview.com/tv.js';
        document.head.appendChild(p);
    })();
  </script>
</body>
</html>
